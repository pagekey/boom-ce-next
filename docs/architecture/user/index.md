---
status: accepted
creation-date: "2024-01-23"
authors: [ "@stephengrice" ]
coach: "n/a"
approvers: [ "@stephengrice" ]
---

# User Accounts

## Summary

Boom needs a way for people to create and login to accounts. This allows data generated by each person to be associated with them and not mixed in with everyone else's data. The user creates an account using an email and password. They receive a confirmation email and confirm their account, then are able to login with the email and password provided. Upon first sign-in, information such as Display Name, Native Language, and Target Langauge are collected.

## Motivation

If we have no user accounts, there's no way to track data for each user.

With user accounts, there is potential for social interaction between users on the site.

### Goals

- Users can create accounts
- Users must activate account via email before using it
- Users can reset password

### Non-Goals

Out of scope:
- For now, social login is out of scope (too complex / too much setup)

## Proposal

- Add a registration page asking for email, password, and password confirmation.
- When handling form submission, create user in DB and send email with activation code link.
- On the activation route, check the token for validity.
  - If valid, set account active and redirect. 
  - Otherwise, display failure message.
- User can login using email and password, receiving an auth token.
- User can logout by deleting the auth token.

## Design and implementation details

### User Story

The user story is summarized by this flow chart.

```mermaid
flowchart TD
    %% Declarations
    %% ------------
    %% Email Templates
%%  (none)
    %% Routes

    %% Connections
    %% ------------
    HomePage -->|clicks login| LoginPage
    HomePage -->|clicks sign up| RegisterPage
    RegisterPage -->|submits invalid form| RegisterPage
    RegisterPage -->|submits valid form| SendEmail{RegisterRoute}
    SendEmail -->|user checks email| ActivationEmail
    ActivationEmail -->|user clicks link| CheckActivation{ActivateRoute}
    CheckActivation -->|invalid| ActivationFailedPage
    CheckActivation -->|success| GettingStartedPage
    LoginPage -->|error| LoginPage
    LoginPage -->|success| CheckAccount{LoginRoute}
    LoginPage -->|clicks forgot password| ForgotPasswordPage
    ForgotPasswordPage -->|submits| ForgotPasswordRoute{ForgotPasswordRoute}
    ForgotPasswordRoute --> ForgotPasswordEmail
    ForgotPasswordEmail --> ResetPasswordPage
    ResetPasswordPage --> ResetPasswordRoute{ResetPasswordRoute}
    ResetPasswordRoute --> LoginPage
    CheckAccount -->|Already setup| DashboardPage
    CheckAccount -->|New user| GettingStartedPage
    GettingStartedPage -->|success| OnboardUserRoute{OnboardUserRoute}
    OnboardUserRoute -->|success| DashboardPage
    DashboardPage -->|clicks logout| LogoutRoute{LogoutRoute}
    LogoutRoute -->|delete session| HomePage

    GetLanguagesRoute <-->|initial info| GettingStartedPage 
    GetLanguagesRoute{GetLanguagesRoute}

    %% Styles
    %% ------------
    %% Email Templates
    style ActivationEmail fill:LightGoldenRodYellow,color:black
    style ForgotPasswordEmail fill:LightGoldenRodYellow,color:black
    %% Routes
    style SendEmail fill:pink,color:black
    style CheckActivation fill:pink,color:black
    style CheckAccount fill:pink,color:black
    style GetLanguagesRoute fill:pink,color:black
    style LogoutRoute fill:pink,color:black
    style OnboardUserRoute fill:pink,color:black
    style ForgotPasswordRoute fill:pink,color:black
    style ResetPasswordRoute fill:pink,color:black
```

### Components

None

### Pages

#### ActivationFailedPage

This page displays a simple message telling the user that their account activation failed.

**Components**

- Activation message
- Home button

**Requests**

None

#### Dashboard Page

This page contains a welcome message for the now logged-in user.

**Components**

- Welcome text

**Requests**

None

#### Forgot Password Page

On this page, the user types in their email and hits submit to send a request to the [Forgot Password Route](#forgot-password-route).

**Components**

- Email field
- Submit button

**Requests**

- Forgot Password Route

#### Getting Started Page

On the page, the user sets up their display name and first LanguagePair. These are saved to their profile upon creation.

Upon submission, this page will submit to the [Onboard User](#onboard-user) route.

**Components**

- Display name field
- Native language multi-select
- Target language multi-select

**Requests**

- Get Languages Route

#### Home Page

The home page will contain sign up and login buttons somewhere.

If the user is already logged in, it will redirect to the dashboard.

**Components**

TODO

**Requests**

TODO

#### Login Page

On this page, the user types in their email and password and presses enter / clicks the submit button. On success, they are redirected to either the [Getting Started Page](#getting-started-page) or the [Dashboard Page](#dashboard-page)

**Components**

TODO

**Requests**

TODO

#### Register Page

This page lets the user register. The fewest fields possible are included to get the user signed up as quickly as possible. Additional fields will be filled in after the user activates their account.

**Components**

- Email field
- Password field
- Password Confirmation field

**Requests**

TODO

#### Reset Password Page

This page shows a form for the user to reset their password, including these components:

**Components**

- Old password field
- New password field
- New password confirmation field
- Submit button

**Requests**

TODO


### Email Templates

#### Activation Email

This email contains a link to the [Activate Route](#activate-route) with a token as a GET variable.

**Components**

TODO

#### ForgotPasswordEmail

This password contains a special link that the user can click to open the ResetPasswordPage and reset their password.

**Components**

TODO

### Routes

#### Activate Route

TODO

#### Forgot Password Route

TODO

#### Get Languages Route

TODO

#### Login Route

TODO

#### Logout Route

TODO

#### Onboard User Route

TODO

#### Register Route

TODO

#### Reset Password Route

TODO

### DB Design

Only the basic tables required for user accounts and language selection will be included in this design doc.

#### User

User is implemented using a Prisma schema.

Field | Type | Description
------|------|------------
id | Int | Auto-incremented unique id
created | DateTime | Time of registration
email | String | Unique email
passwordHash | String | Hashed password
passwordSalt | String | Salt for password
interfaceLanguage | Language | Language that the user prefers to display the application in

#### LanguagePair

Field | Type | Description
------|-----|------------
id | Int | Auto-incremented unique id
user | User | User who is learning this LanguagePair
source | Language | Language you already know
target | Language | Language you are learning

#### Language

Field | Type | Description
-------|------|------------
id | Int | Auto-incremented unique id
name | String | Language name (English)
code | String | Three letter ISO code for the language

## Alternative Solutions

Make Boom a local-only application. It's offline all the time, or a desktop app, and there is no way for users to interact. Kinda lame.
